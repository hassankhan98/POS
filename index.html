<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>POS Web App</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
<div class="container-fluid">
  <div class="row">
    <!-- Sidebar -->
    <div class="col-md-2 bg-dark text-white p-3 vh-100">
      <h4 class="mb-4">POS Dashboard</h4>
      <ul class="nav flex-column">
        <li class="nav-item"><a href="#" class="nav-link text-white" onclick="showSection('dashboard')">Dashboard</a></li>
        <li class="nav-item"><a href="#" class="nav-link text-white" onclick="showSection('addProduct')">Add Product</a></li>
        <li class="nav-item"><a href="#" class="nav-link text-white" onclick="showSection('recordSale')">Record Sale</a></li>
        <li class="nav-item"><a href="#" class="nav-link text-white" onclick="showSection('productsTable')">All Products</a></li>
        <li class="nav-item"><a href="#" class="nav-link text-white" onclick="showSection('salesTable')">All Sales</a></li>
      </ul>
    </div>

    <!-- Main Content -->
    <div class="col-md-10 p-4">
      <!-- Dashboard -->
      <div id="dashboard" class="section">
        <h3>Dashboard</h3>
        <p>Total Products: <span id="total-products">0</span></p>
        <p>Total Sales: <span id="total-sales">0</span></p>
        <p>Total Revenue: $<span id="total-revenue">0</span></p>
        <canvas id="salesChart" height="100"></canvas>
      </div>

      <!-- Add Product -->
      <div id="addProduct" class="section d-none">
        <h3>Add Product</h3>
        <form id="addProductForm">
          <div class="mb-2"><label>Product Name</label><input type="text" id="productName" class="form-control" required></div>
          <div class="mb-2"><label>Units</label><input type="number" id="productUnits" class="form-control" required></div>
          <div class="mb-2"><label>Cost Price</label><input type="number" id="costPrice" class="form-control" required></div>
          <div class="mb-2"><label>Selling Price</label><input type="number" id="sellingPrice" class="form-control" required></div>
          <button type="submit" class="btn btn-primary">Add Product</button>
        </form>
      </div>

      <!-- Record Sale -->
      <div id="recordSale" class="section d-none">
        <h3>Record Sale</h3>
        <form id="recordSaleForm">
          <div class="mb-2">
            <label>Product</label>
            <select id="saleProduct" class="form-control"></select>
          </div>
          <div class="mb-2"><label>Sold Price</label><input type="number" id="soldPrice" class="form-control" required></div>
          <div class="mb-2">
            <label>Platform</label>
            <select id="salePlatform" class="form-control">
              <option value="TikTok">TikTok</option>
              <option value="eBay">eBay</option>
              <option value="Vinted">Vinted</option>
              <option value="Cash">Cash</option>
              <option value="Facebook">Facebook</option>
              <option value="Depop">Depop</option>
            </select>
          </div>
          <button type="submit" class="btn btn-success">Save Sale</button>
        </form>
      </div>

      <!-- Products Table -->
      <div id="productsTable" class="section d-none">
        <h3>All Products</h3>
        <table class="table table-bordered">
          <thead><tr><th>Name</th><th>Units</th><th>Cost</th><th>Selling</th><th>Action</th></tr></thead>
          <tbody id="products-list"></tbody>
        </table>
      </div>

      <!-- Sales Table -->
      <div id="salesTable" class="section d-none">
        <h3>All Sales</h3>
        <table class="table table-bordered">
          <thead><tr><th>Product</th><th>Price</th><th>Platform</th><th>Date</th><th>Action</th></tr></thead>
          <tbody id="sales-list"></tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<script>
// ================== Firebase Setup ==================
const firebaseConfig = {
  apiKey: "AIzaSyBgG89RoBGc-Gqe2TYnO_iPSdtc8XxQwJw",
  authDomain: "pos-web-app-ed7e9.firebaseapp.com",
  projectId: "pos-web-app-ed7e9",
  storageBucket: "pos-web-app-ed7e9.appspot.com",
  messagingSenderId: "386790885396",
  appId: "1:386790885396:web:83955d99b689cf377ebf01"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// ================== Navigation ==================
function showSection(id) {
  document.querySelectorAll('.section').forEach(sec => sec.classList.add('d-none'));
  document.getElementById(id).classList.remove('d-none');
  if (id === "productsTable") loadProductsTable();
  if (id === "salesTable") loadSalesTable();
}

// ================== Add Product ==================
document.getElementById("addProductForm").addEventListener("submit", async (e) => {
  e.preventDefault();
  const name = document.getElementById("productName").value;
  const units = parseInt(document.getElementById("productUnits").value);
  const cost = parseFloat(document.getElementById("costPrice").value);
  const selling = parseFloat(document.getElementById("sellingPrice").value);

  await db.collection("products").add({ name, units, cost, selling });
  alert("Product Added!");
  e.target.reset();
  loadProducts();
});

// ================== Record Sale ==================
document.getElementById("recordSaleForm").addEventListener("submit", async (e) => {
  e.preventDefault();
  const productId = document.getElementById("saleProduct").value;
  const price = parseFloat(document.getElementById("soldPrice").value);
  const platform = document.getElementById("salePlatform").value;
  const date = new Date().toISOString();

  await db.collection("sales").add({ productId, price, platform, date });
  alert("Sale Recorded!");
  e.target.reset();
  updateDashboard();
});

// ================== Load Products in Dropdown ==================
async function loadProducts() {
  const snapshot = await db.collection("products").get();
  const select = document.getElementById("saleProduct");
  select.innerHTML = "";
  snapshot.forEach(doc => {
    const option = document.createElement("option");
    option.value = doc.id;
    option.textContent = doc.data().name;
    select.appendChild(option);
  });
  updateDashboard();
}

// ================== Products Table ==================
async function loadProductsTable() {
  const snapshot = await db.collection("products").get();
  const tbody = document.getElementById("products-list");
  tbody.innerHTML = "";
  snapshot.forEach(doc => {
    const p = doc.data();
    const tr = document.createElement("tr");
    tr.innerHTML = `<td>${p.name}</td><td>${p.units}</td><td>${p.cost}</td><td>${p.selling}</td>
                    <td><button class="btn btn-danger btn-sm" onclick="deleteProduct('${doc.id}')">Delete</button></td>`;
    tbody.appendChild(tr);
  });
}
async function deleteProduct(id) {
  if (confirm("Delete this product?")) {
    await db.collection("products").doc(id).delete();
    loadProductsTable();
    loadProducts();
    updateDashboard();
  }
}

// ================== Sales Table ==================
async function loadSalesTable() {
  const snapshot = await db.collection("sales").get();
  const tbody = document.getElementById("sales-list");
  tbody.innerHTML = "";
  for (const doc of snapshot.docs) {
    const s = doc.data();
    const product = await db.collection("products").doc(s.productId).get();
    const productName = product.exists ? product.data().name : "Unknown";
    const tr = document.createElement("tr");
    tr.innerHTML = `<td>${productName}</td><td>${s.price}</td><td>${s.platform}</td><td>${new Date(s.date).toLocaleString()}</td>
                    <td><button class="btn btn-danger btn-sm" onclick="deleteSale('${doc.id}')">Delete</button></td>`;
    tbody.appendChild(tr);
  }
}
async function deleteSale(id) {
  if (confirm("Delete this sale?")) {
    await db.collection("sales").doc(id).delete();
    loadSalesTable();
    updateDashboard();
  }
}

// ================== Dashboard Update ==================
let salesChart;
async function updateDashboard() {
  const productsSnap = await db.collection("products").get();
  document.getElementById("total-products").textContent = productsSnap.size;

  const salesSnap = await db.collection("sales").get();
  document.getElementById("total-sales").textContent = salesSnap.size;

  let totalRevenue = 0;
  let labels = [];
  let revenue = [];

  salesSnap.forEach(doc => {
    const sale = doc.data();
    totalRevenue += sale.price;
    labels.push(new Date(sale.date).toLocaleDateString());
    revenue.push(sale.price);
  });
  document.getElementById("total-revenue").textContent = totalRevenue.toFixed(2);

  if (salesChart) salesChart.destroy();
  const ctx = document.getElementById("salesChart").getContext("2d");
  salesChart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: labels,
      datasets: [{ label: 'Revenue', data: revenue, borderColor: 'blue', fill: false }]
    }
  });
}

loadProducts();
</script>
</body>
</html>
